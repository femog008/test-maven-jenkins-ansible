---
- hosts: localhost
  connection: local 
  become: true
  become_user: vagrant
  gather_facts: false  
  tasks:
    - name: Package war file
      command: 'mvn clean package'
    
- hosts: web
  #become: true
  become_user: vagrant
  #vars_files:
  #  - keys.yml
  #roles:
  #  - role: geerlingguy.java
  #  - role: cetic.tomcat  
  tasks:
    - name: include java
      include_role:
        name: geerlingguy.java
    - name: include tomcat
      include_role:
        name: cetic.tomcat
    - name: Copy WAR to server
      copy:
        src: './target/demo-0.0.1-SNAPSHOT.war'
        dest: '/opt/apache-tomcat-7.0.61/webapps/'
      when:
        - ansible_facts['distribution'] == 'RedHat'
      notify: restart tomcat
      
    - name: Delete remote war file
      file: path={{ warRemotePath }}/{{ warName }} state=absent
    
        
  handlers:
  - name: restart tomcat8
    service: name=tomcat8 state=restarted